{
  "id": 44829272,
  "lang": "ru",
  "summary": "Пространственно-временной индекс потока BlueSky\n\nДобавил в Aurora «пространственную ленту»: на карте BlueSky теперь показываются посты только тех аккаунтов, которые попадают в текущий видимый фрагмент. Работает на любом масштабе — от всей сети до отдельного квартала.\n\nКак устроено\n- Кластеризация и раскладка считаются дома на SQLite, статика выкладывается в R2.\n- Для ленты нужен был бэкенд, принимающий firehose через Jetstream WebSocket и отвечающий на пространственные запросы в реальном времени.\n\nЗадача индексатора\n- Получает посты и координаты пользователей (фиксированы раз в месяц).\n- Поддерживает `observe(post)` / `query(area, limit)` → последние посты в прямоугольнике.\n\nПроблема\nОдновременно фильтровать по 2-D и сортировать по времени сложно. R-tree с третьей осью «время» не умеет сортировать. Priority-search-tree не обобщается на 2-D.\n\nРешение\nНе нужен полный перебор: хватит top-k свежих постов. Используем «quadtree из кольцевых буферов»:\n\n1. Строим quadtree по позициям пользователей: лист = k-бакет.\n2. В каждом листе — кольцевой буфер на k последних постов.\n3. Запрос: спускаемся по дереву, собираем посты из пересекающихся листьев, берём сверху по времени.\n\nПлюсы: полностью в памяти, O(log n) на запрос, простая сборка мусора (выкидываем старое из буферов).",
  "inputHash": "361027c64b31c452c35e5ce3e1f2a2fc1fc356772b0d85a789e8b557e9736446",
  "model": "moonshotai/kimi-k2",
  "createdISO": "2025-08-07T23:57:07.868Z"
}