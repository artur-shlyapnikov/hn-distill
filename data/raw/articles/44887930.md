Supporting org.apache.xml.security in GraalVM 

# Guust Ysebie

Developer | PDF expert

[home](/)

## Supporting org.apache.xml.security in graalVM

When working today at out european trusted lists feature $DAY\_JOB we had an issue which was coming from org.apache.xml.security when trying to run our testsuite natively compiled with graalVM.

java.util.MissingResourceException: 
Can't find bundle for base name org/apache/xml/security/resource/xmlsecurity locale en\_US

This indicates that the required resource bundles are not available in the generated binary. The reason being that it was trimmed by graalVM as it didn't seem to be used.  
  
To fix this we need to add the following to our build arguments when building the native test executable.

\-H:IncludeResourceBundles=org.apache.xml.security.resource.xmlsecurity

When we add this and try compiling + running the tests once again, we now encounter the following issue:

org.apache.xml.security.signature.XMLSignatureException: 
The requested algorithm http://www.w3.org/2000/09/xmldsig#dsa-sha1 does not exist. 
Original Message was: org.apache.xml.security.algorithms.implementations.SignatureDSA
Original Exception was java.lang.InstantiationException: 
org.apache.xml.security.algorithms.implementations.SignatureDSA

So now the resourcbunldes are loaded, but it can't find any of the hashing algoritms we need, probably also being trimmed out of the native binary because they get instaniated with the usage of reflection. So GraalVM has an option to define we require in a configuration called reflect-config.json you can pass it as following: \-H:ReflectionConfigurationFiles=${basedir}/path/to/reflect-config.json And in that file we need to add the required type we need to make sure GraalVM add's to the native binary  
Something like this:

\[
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureECDSA$SignatureECDSASHA1",
    "allDeclaredConstructors": true
  }
\]

When we run again we get a different error related to ECDSASHA256 so that means we have to add that type as well, and you guys reading this are probably pretty smart so will already now that we need to add all those implementations to the configuration file. And we also need some additional types unrelated to hashing algortims  
See full config below to copy paste into your application

## Making this configuration available for everyone

GraalVM has an option to provide these config files in the [GraalVM Reachability Metadata Repository](https://github.com/oracle/graalvm-reachability-metadata) this way not all users of this library have to provide it themselves but can be loaded automatically. So the next blog post is gonna be about how we officially get test support level 1 on [GraalVM supported frameworks](https://www.graalvm.org/native-image/libraries-and-frameworks/)  
  
Questions, remarks, comments? Send mail a mail or whatsapp!  
  
Guust

## Full configuration file to get org.apache.xml.security working.

\[{
    "name": "com.sun.org.apache.xpath.internal.functions.FuncNormalizeSpace",
    "methods": \[
      {
        "name": "",
        "parameterTypes": \[\]
      }
    \]
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureBaseRSA$SignatureRSASHA256",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureBaseRSA$SignatureRSASHA512",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.c14n.implementations.Canonicalizer20010315ExclOmitComments",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureBaseRSA$SignatureRSASHA1",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureBaseRSA$SignatureRSASHA384",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureBaseRSA$SignatureRSAMD5",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureECDSA",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureDSA",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.c14n.implementations.Canonicalizer20010315OmitComments",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.c14n.implementations.Canonicalizer20010315WithComments",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.c14n.implementations.Canonicalizer20010315ExclWithComments",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureBaseRSA$SignatureRSASHA1MGF1",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureBaseRSA$SignatureRSASHA224MGF1",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureBaseRSA$SignatureRSASHA256MGF1",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureBaseRSA$SignatureRSASHA384MGF1",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureBaseRSA$SignatureRSASHA512MGF1",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureECDSA$SignatureECDSASHA1",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureECDSA$SignatureECDSASHA224",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureECDSA$SignatureECDSASHA256",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureECDSA$SignatureECDSASHA384",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureECDSA$SignatureECDSASHA512",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureBaseRSA$SignatureRSASHA224",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureHMAC",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureHMAC$SignatureHMACSHA1",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureHMAC$SignatureHMACSHA256",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureHMAC$SignatureHMACSHA384",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.algorithms.implementations.SignatureHMAC$SignatureHMACSHA512",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.transforms.implementations.TransformEnvelopedSignature",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.transforms.implementations.TransformXPath",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.transforms.implementations.TransformBase64",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.transforms.implementations.TransformC14NExclusive",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.transforms.implementations.TransformC14NInclusive",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.encryption.XMLCipher",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.encryption.EncryptedKey",
    "allDeclaredConstructors": true
  },
  {
    "name": "org.apache.xml.security.Init",
    "allDeclaredConstructors": true
  }\]
                

Â© 2025 Guust Ysebie