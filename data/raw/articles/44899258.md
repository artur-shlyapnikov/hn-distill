This is really cool:

...blah...

<script>writeImage("dog.jpg", "my dog")</script>

... blah blah...

Under the hood it works like this:

function writeImage(url, title) {
  document.write(\`
    <img src="${url}"><div class="caption">${title}</div>
  \`);
}

And leads to:

...blah...
  
<img src="dog.jpg"><div class="caption">My dog</div>
  
...blah blah...

Whoa, HTML templating? It inserts the stuff directly where the function is called, and it just works? And it's been available in browsers forever? Stop the presses, I gotta rewrite all my static sites

The same approach works for reusing chunks of HTML between pages:

<script src="common.js"></script>
<script>writeMetaViewport()</script>
...page content...

when in common.js you have something like this:

function writeMetaViewport() {
  document.write(\`
    <meta name="viewport" content="width=1000px, maximum-scale=1">
  \`);
}

Now can make a site with reusable pieces and it'll work purely on static hosting, no site generator, no server-side code, development workflow is Ctrl+S and reload. Amazingness.

But this function was known forever and all the wizards say it's dangerous... why?

* * *

Why indeed? Well, it's true that it was used badly.

I'll go ahead and propose two rules to use document.write() safely and well:

**Rule 1.** Only call it at the document toplevel, or in functions whose name begins with "write". Apply the same rule recursively to functions that begin with "write".

**Rule 2.** Never use document.write() to output <script> or <style> tags.

The first rule is easy to explain. If you call document.write() after the page is loaded, it'll delete the whole page. Yes really. So it's worth separating all functions into those that can write, and those that can't. It's easily checkable.

For the second rule we go into a bit more detail. What happens if you output a <script>? It's the same as a blocking web request. If there's two of them on the page, they'll happen sequentially. Since <style> blocks subsequent <script>'s from executing until it's loaded, the same goes for <style>. Let's just ban the two.

How about other tags that point to external resources, like <img>? The difference is they can be non-blocking. Outputting a bunch of <img>'s lets the loading happen in parallel, any slowdown is negligible. I'm doing this on my site and it's honestly super fast.

Now ok, there's another danger that might lead to another rule. If you use document.write() to output partial or not well-formed tags, it'll happily do that. Personally I always make it output complete tags. But since other people might want to use it differently, like outputting one attribute of a tag, this is maybe not a hard and fast rule.

Cool, so we have 2.5 rules and can use the technique. What is it good for?

* * *

I think document.write() as discussed here is mostly useful for simple sites, the ones you'd use a static generator for, or maybe a little PHP. We get a kind of HTML templating that's a substitute for both things, but I wouldn't push it too much farther than that.

On this site I use document.write() to output headers and some repeated elements. On this page for example. You can try reloading a few times to check the speed, to me it's super fast, like a static site. Maybe because it runs during parsing and doesn't wait for onLoad, so it gets an advantage over SPAs.

Anyway thanks for coming to my talk. I need to say a few words on what inspired this. There was Paco Coursey's article [Grug XSLT](https://github.com/pacocoursey/xslt) a few weeks ago and the promise of it really appealed to me a lot: a browser-based templating system that works on static hosting, no generators, no dynamic code, but still you can make any pieces reusable and DRY. However in practice it made you turn the whole site into XML and it's just a bit clunky. So I started thinking on and off about other solutions that might fulfill the same kind of promise. And now came up with this.

* * *

EDIT after this article has been online for a bit: Google can now find it, and shows the right title. Which is pretty cool, given that the <title> tag in the article comes from document.write() in the first place! So from a crawlers and SEO perspective, it seems things work well.

That said, the main drawback of the idea is still the JS requirement. That was the #1 feedback and I agree with it.

Some people have pointed out that the function is [deprecated](https://developer.mozilla.org/en-US/docs/Web/API/Document/write). It still works in all browsers and I'm guessing it will continue to work, but still good to be aware of this.

Also, some people have mentioned document.currentScript.replaceWith() or document.currentScript.parentElement.appendChild(), for example here's a [post by Lean Rada](https://leanrada.com/notes/inline-rendering-currentscript/) that I really should've seen earlier. This also inserts elements in-place, which is cool! In fact I'd say you should probably use these methods instead, if you're worried about safety at all.

The only difference I found is a couple small annoyances. You can't write certain meta tags, like charset, and you can't output stuff at the start of the page:

<!doctype html>
<script>document.currentScript.replaceWith(...stuff on top of page...)</script>
...content...

This will show just "content", because the script will think its parent is <head>, and <body> doesn't exist yet. The only way to fix that is to have the <body> tag start above the script. With document.write, these things work more as expected.