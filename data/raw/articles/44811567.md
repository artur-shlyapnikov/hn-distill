Title: GitHub - manzaltu/claude-code-ide.el: Claude Code IDE integration for Emacs

URL Source: https://github.com/manzaltu/claude-code-ide.el

Markdown Content:
Claude Code IDE for Emacs
-------------------------

[](https://github.com/manzaltu/claude-code-ide.el#claude-code-ide-for-emacs)
[![Image 1: https://github.com/manzaltu/claude-code-ide.el/workflows/CI/badge.svg](https://github.com/manzaltu/claude-code-ide.el/workflows/CI/badge.svg)](https://github.com/manzaltu/claude-code-ide.el/actions/workflows/test.yml)[![Image 2: https://img.shields.io/badge/GNU%20Emacs-28--30-blueviolet.svg](https://camo.githubusercontent.com/e5e2c0cdd7eb562ab27df3a8f5a564f5d96dce41857e6712bef14d9e5b49bf4a/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f474e55253230456d6163732d32382d2d33302d626c756576696f6c65742e737667)](https://www.gnu.org/software/emacs/)[![Image 3: https://img.shields.io/badge/License-GPL%20v3-blue.svg](https://camo.githubusercontent.com/93ca07ea63e4649ae72b87de86d82eedeab50e744fa6e07ee95e5344779fb930/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d47504c25323076332d626c75652e737667)](https://www.gnu.org/licenses/gpl-3.0)

Overview
--------

[](https://github.com/manzaltu/claude-code-ide.el#overview)
Claude Code IDE for Emacs provides native integration with Claude Code CLI through the Model Context Protocol (MCP). Unlike simple terminal wrappers, this package creates a bidirectional bridge between Claude and Emacs, enabling Claude to understand and leverage Emacs’ powerful features—from LSP and project management to custom Elisp functions. This transforms Claude into a true Emacs-aware AI assistant that works within your existing workflow and can interact with your entire Emacs ecosystem.

Features
--------

[](https://github.com/manzaltu/claude-code-ide.el#features)
*   Automatic project detection and session management
*   Terminal integration with full color support using `vterm` or `eat`
*   MCP protocol implementation for IDE integration
*   Tool support for file operations, editor state, and workspace info
*   Extensible MCP tools server for accessing Emacs commands (xrefs, tree-sitter, project info, e.g.)
*   Diagnostic integration with Flycheck and Flymake
*   Advanced diff view with ediff integration
*   Tab-bar support for proper context switching
*   Selection and buffer tracking for better context awareness

Emacs Tool Integration
----------------------

[](https://github.com/manzaltu/claude-code-ide.el#emacs-tool-integration)
This package enables Claude Code to leverage the full power of Emacs through MCP tools integration. Claude can directly access and utilize Emacs capabilities including:

*   **Language Server Protocol (LSP)** integration through xref commands for intelligent code navigation (eglot, lsp-mode and others)
*   **Tree-sitter** for syntax tree analysis and understanding code structure at the AST level
*   **Imenu** for structured symbol listing and navigation within files
*   **Project** integration for project-aware operations
*   **Any Emacs command or function** can be exposed as an MCP tool, allowing Claude to: 
    *   Perform project-wide searches and refactoring
    *   Access specialized modes and their features
    *   Execute custom Elisp functions tailored to your workflow

This deep integration means Claude Code understands your project context and can leverage Emacs’ extensive ecosystem to provide more intelligent and context-aware assistance.

Screenshots
-----------

[](https://github.com/manzaltu/claude-code-ide.el#screenshots)
### Active File Awareness

[](https://github.com/manzaltu/claude-code-ide.el#active-file-awareness)
[![Image 4](https://github.com/manzaltu/claude-code-ide.el/raw/25053b5f1b8123eed5c3f00e8b3e9687ee33391d/screenshots/file.png)](https://github.com/manzaltu/claude-code-ide.el/blob/25053b5f1b8123eed5c3f00e8b3e9687ee33391d/screenshots/file.png)

_Claude Code automatically knows which file you’re currently viewing in Emacs_

### Code Selection Context

[](https://github.com/manzaltu/claude-code-ide.el#code-selection-context)
[![Image 5](https://github.com/manzaltu/claude-code-ide.el/raw/25053b5f1b8123eed5c3f00e8b3e9687ee33391d/screenshots/selection.png)](https://github.com/manzaltu/claude-code-ide.el/blob/25053b5f1b8123eed5c3f00e8b3e9687ee33391d/screenshots/selection.png)

_Claude Code can access and work with selected text in your buffers_

### Advanced Diff View with Diagnostics

[](https://github.com/manzaltu/claude-code-ide.el#advanced-diff-view-with-diagnostics)
[![Image 6](https://github.com/manzaltu/claude-code-ide.el/raw/25053b5f1b8123eed5c3f00e8b3e9687ee33391d/screenshots/ediff_diag.png)](https://github.com/manzaltu/claude-code-ide.el/blob/25053b5f1b8123eed5c3f00e8b3e9687ee33391d/screenshots/ediff_diag.png)

_Integrated ediff view for code changes, with Claude Code able to directly access diagnostic data (errors, warnings, etc.) from opened files_

### Automatic Text Mentions

[](https://github.com/manzaltu/claude-code-ide.el#automatic-text-mentions)
[![Image 7](https://github.com/manzaltu/claude-code-ide.el/raw/25053b5f1b8123eed5c3f00e8b3e9687ee33391d/screenshots/mentions.png)](https://github.com/manzaltu/claude-code-ide.el/blob/25053b5f1b8123eed5c3f00e8b3e9687ee33391d/screenshots/mentions.png)

_Automatically mention and reference selected text in Claude conversations_

### Session Restoration

[](https://github.com/manzaltu/claude-code-ide.el#session-restoration)
[![Image 8](https://github.com/manzaltu/claude-code-ide.el/raw/25053b5f1b8123eed5c3f00e8b3e9687ee33391d/screenshots/restore.png)](https://github.com/manzaltu/claude-code-ide.el/blob/25053b5f1b8123eed5c3f00e8b3e9687ee33391d/screenshots/restore.png)

_Resume previous Claude Code conversations with the –resume flag_

Installation
------------

[](https://github.com/manzaltu/claude-code-ide.el#installation)
Prerequisites
-------------

[](https://github.com/manzaltu/claude-code-ide.el#prerequisites)
*   Emacs 28.1 or higher
*   Claude Code CLI installed and available in PATH
*   `vterm` or `eat` package (for terminal support)

Installing Claude Code CLI
--------------------------

[](https://github.com/manzaltu/claude-code-ide.el#installing-claude-code-cli)
Follow the installation instructions at [Claude Code Documentation](https://docs.anthropic.com/en/docs/claude-code).

Installing the Emacs Package
----------------------------

[](https://github.com/manzaltu/claude-code-ide.el#installing-the-emacs-package)
Currently, this package is in early development. To install using `use-package` and [straight.el](https://github.com/raxod502/straight.el):

(use-package claude-code-ide
  :straight (:type git :host github :repo "manzaltu/claude-code-ide.el")
  :bind ("C-c C-'" . claude-code-ide-menu) ; Set your favorite keybinding
  :config
  (claude-code-ide-emacs-tools-setup)) ; Optionally enable Emacs MCP tools

Usage
-----

[](https://github.com/manzaltu/claude-code-ide.el#usage)
Basic Commands
--------------

[](https://github.com/manzaltu/claude-code-ide.el#basic-commands)
The easiest way to interact with Claude Code IDE is through the transient menu interface, which provides visual access to all available commands. Simply run `M-x claude-code-ide-menu` to open the interactive menu.

| Command | Description |
| --- | --- |
| `M-x claude-code-ide-menu` | Open transient menu with all Claude Code commands |
| `M-x claude-code-ide-emacs-tools-setup` | Set up built-in MCP tools (e.g. xref, project) |
| `M-x claude-code-ide` | Start Claude Code for the current project |
| `M-x claude-code-ide-send-prompt` | Send prompt to Claude from minibuffer input |
| `M-x claude-code-ide-continue` | Continue most recent conversation in directory |
| `M-x claude-code-ide-resume` | Resume Claude Code with previous conversation |
| `M-x claude-code-ide-stop` | Stop Claude Code for the current project |
| `M-x claude-code-ide-switch-to-buffer` | Switch to project’s Claude buffer |
| `M-x claude-code-ide-list-sessions` | List all active Claude Code sessions and switch |
| `M-x claude-code-ide-check-status` | Check if Claude Code CLI is installed and working |
| `M-x claude-code-ide-insert-at-mentioned` | Send selected text to Claude prompt |
| `M-x claude-code-ide-send-escape` | Send escape key to Claude terminal |
| `M-x claude-code-ide-insert-newline` | Insert newline in Claude prompt (sends \ + Enter) |
| `M-x claude-code-ide-toggle` | Toggle visibility of Claude Code window |
| `M-x claude-code-ide-show-debug` | Show the debug buffer with WebSocket messages |
| `M-x claude-code-ide-clear-debug` | Clear the debug buffer |

Multi-Project Support
---------------------

[](https://github.com/manzaltu/claude-code-ide.el#multi-project-support)
Claude Code IDE automatically detects your project using Emacs’ built-in `project.el`. Each project gets its own Claude Code instance with a unique buffer name like `*claude-code[project-name]*`.

You can run multiple Claude Code instances simultaneously for different projects. Use `claude-code-ide-list-sessions` to see all active sessions and switch between them.

Window Management
-----------------

[](https://github.com/manzaltu/claude-code-ide.el#window-management)
*   Running `claude-code-ide` when a session is already active will toggle the window visibility
*   The window can be closed with standard Emacs window commands (`C-x 0`) without stopping Claude

Configuration
-------------

[](https://github.com/manzaltu/claude-code-ide.el#configuration)
### Configuration Variables

[](https://github.com/manzaltu/claude-code-ide.el#configuration-variables)
| Variable | Description | Default |
| --- | --- | --- |
| `claude-code-ide-cli-path` | Path to Claude Code CLI | `"claude"` |
| `claude-code-ide-buffer-name-function` | Function for buffer naming | `claude-code-ide--default-buffer-name` |
| `claude-code-ide-cli-debug` | Enable CLI debug mode (-d flag) | `nil` |
| `claude-code-ide-cli-extra-flags` | Additional CLI flags (e.g. “–model”) | `""` |
| `claude-code-ide-debug` | Enable debug logging | `nil` |
| `claude-code-ide-terminal-backend` | Terminal backend (vterm or eat) | `'vterm` |
| `claude-code-ide-log-with-context` | Include session context in log messages | `t` |
| `claude-code-ide-debug-buffer` | Buffer name for debug output | `"*claude-code-ide-debug*"` |
| `claude-code-ide-use-side-window` | Use side window vs regular buffer | `t` |
| `claude-code-ide-window-side` | Side for Claude window | `'right` |
| `claude-code-ide-window-width` | Width for side windows (left/right) | `90` |
| `claude-code-ide-window-height` | Height for side windows (top/bottom) | `20` |
| `claude-code-ide-focus-on-open` | Focus Claude window when opened | `t` |
| `claude-code-ide-focus-claude-after-ediff` | Focus Claude window after opening ediff | `t` |
| `claude-code-ide-show-claude-window-in-ediff` | Show Claude window during ediff | `t` |
| `claude-code-ide-system-prompt` | Custom system prompt to append | `nil` |
| `claude-code-ide-enable-mcp-server` | Enable MCP tools server | `nil` |
| `claude-code-ide-mcp-server-port` | Port for MCP tools server | `nil` (auto-select) |
| `claude-code-ide-mcp-server-tools` | Alist of exposed Emacs functions | `nil` |
| `claude-code-ide-diagnostics-backend` | Diagnostics backend (auto/flycheck/flymake) | `'auto` |
| `claude-code-ide-prevent-reflow-glitch` | Prevent terminal reflow glitch (bug #1422) | `t` |

### Side Window Configuration

[](https://github.com/manzaltu/claude-code-ide.el#side-window-configuration)
Claude Code buffers open in a side window by default. You can customize the placement:

;; Open Claude on the left side
(setq claude-code-ide-window-side 'left)

;; Open Claude at the bottom with custom height
(setq claude-code-ide-window-side 'bottom
      claude-code-ide-window-height 30)

;; Open Claude on the right with custom width
(setq claude-code-ide-window-side 'right
      claude-code-ide-window-width 100)

;; Don't automatically focus the Claude window
(setq claude-code-ide-focus-on-open nil)

;; Keep focus on ediff control window when opening diffs
(setq claude-code-ide-focus-claude-after-ediff nil)

;; Hide Claude window during ediff for more screen space
(setq claude-code-ide-show-claude-window-in-ediff nil)

Or, if you’d prefer to use a regular window:

;; Use regular window instead of side window
(setq claude-code-ide-use-side-window nil)

### Terminal Backend Configuration

[](https://github.com/manzaltu/claude-code-ide.el#terminal-backend-configuration)
Claude Code IDE supports both `vterm` and `eat` as terminal backends. By default, it uses `vterm`, but you can switch to `eat` if preferred:

;; Use eat instead of vterm
(setq claude-code-ide-terminal-backend 'eat)

;; Or switch back to vterm (default)
(setq claude-code-ide-terminal-backend 'vterm)

The `eat` backend is a pure Elisp terminal emulator that may work better in some environments where `vterm` compilation is problematic. Both backends provide full terminal functionality including color support and special key handling.

#### Terminal Keybindings

[](https://github.com/manzaltu/claude-code-ide.el#terminal-keybindings)
Claude Code IDE adds custom keybindings to the terminal for easier interaction:

| Keybinding | Command | Description |
| --- | --- | --- |
| `M-RET` | `claude-code-ide-insert-newline` | Insert a newline in the prompt |
| `C-<escape>` | `claude-code-ide-send-escape` | Send escape key to cancel operations |

These keybindings are automatically set up for both `vterm` and `eat` backends and only apply within Claude Code terminal buffers.

#### Terminal Reflow Glitch Prevention (Temporary)

[](https://github.com/manzaltu/claude-code-ide.el#terminal-reflow-glitch-prevention-temporary)
Claude Code IDE includes a temporary workaround for a known Claude Code bug ([#1422](https://github.com/anthropics/claude-code/issues/1422)) where terminal reflows during window resizes can cause uncontrollable scrolling. This workaround is enabled by default but can be disabled if needed:

;; Disable the terminal reflow glitch prevention (not recommended until bug is fixed)
(setq claude-code-ide-prevent-reflow-glitch nil)

The workaround will be removed once the upstream bug is fixed.

### Diagnostics Configuration

[](https://github.com/manzaltu/claude-code-ide.el#diagnostics-configuration)
Claude Code IDE supports both Flycheck and Flymake for code diagnostics. By default, it will automatically detect which one is active:

;; Let Claude Code automatically detect the active diagnostics backend
(setq claude-code-ide-diagnostics-backend 'auto) ; default

;; Or force a specific backend
(setq claude-code-ide-diagnostics-backend 'flycheck)
(setq claude-code-ide-diagnostics-backend 'flymake)

### Custom Buffer Naming

[](https://github.com/manzaltu/claude-code-ide.el#custom-buffer-naming)
You can customize how Claude Code buffers are named:

(setq claude-code-ide-buffer-name-function
      (lambda (directory)
        (if directory
            (format "*Claude:%s*" (file-name-nondirectory (directory-file-name directory)))
          "*Claude:Global*")))

### Custom CLI Flags

[](https://github.com/manzaltu/claude-code-ide.el#custom-cli-flags)
You can pass additional flags to the Claude Code CLI:

;; Use a specific model
(setq claude-code-ide-cli-extra-flags "--model opus")

;; Pass multiple flags
(setq claude-code-ide-cli-extra-flags "--model opus --no-cache")

;; Flags are added to all Claude Code sessions

Note: These flags are appended to the Claude command after any built-in flags like `-d` (debug) or `-r` (resume).

### Custom System Prompt

[](https://github.com/manzaltu/claude-code-ide.el#custom-system-prompt)
You can append a custom system prompt to Claude’s default prompt, allowing you to customize Claude’s behavior for specific projects or contexts:

;; Set a custom system prompt
(setq claude-code-ide-system-prompt "You are an expert in Elisp and Emacs development.")

;; Or configure it per-project using dir-locals.el
;; In .dir-locals.el:
((nil . ((claude-code-ide-system-prompt . "Focus on functional programming patterns and avoid mutations."))))

;; Set via the transient menu: M-x claude-code-ide-menu → Configuration → Set system prompt

When set, this adds the `--append-system-prompt` flag to the Claude command. Set to `nil` to disable (default).

### Debugging

[](https://github.com/manzaltu/claude-code-ide.el#debugging)
#### Claude CLI Debug Mode

[](https://github.com/manzaltu/claude-code-ide.el#claude-cli-debug-mode)
To enable debug mode for Claude Code CLI (passes the `-d` flag):

(setq claude-code-ide-cli-debug t)

#### Emacs Debug Logging

[](https://github.com/manzaltu/claude-code-ide.el#emacs-debug-logging)
To enable debug logging within Emacs (logs WebSocket messages and JSON-RPC communication):

(setq claude-code-ide-debug t)

Then view debug logs with:

*   `M-x claude-code-ide-show-debug` - Show the debug buffer
*   `M-x claude-code-ide-clear-debug` - Clear the debug buffer

The debug buffer shows:

*   WebSocket connection events
*   All JSON-RPC messages (requests/responses)
*   Error messages and diagnostics
*   General debug information with session context

Multiple Claude Code Instances on One Project
---------------------------------------------

[](https://github.com/manzaltu/claude-code-ide.el#multiple-claude-code-instances-on-one-project)
Using git worktrees is the recommended way for running multiple Claude Code instances on different branches of the same project. This allows you to develop features or fix bugs in parallel:

# Create a new worktree for a feature branch
git worktree add ../myproject-worktree feature-branch

;; Start Claude Code in the main project
find-file /path/to/myproject
M-x claude-code-ide

;; Start another Claude Code instance in the worktree
find-file /path/to/myproject-worktree
M-x claude-code-ide

Each worktree is treated as a separate project by `project.el`, allowing you to have independent Claude Code sessions with their own buffers (e.g., `*claude-code[myproject]*` and `*claude-code[myproject-worktree]*`).

Emacs MCP Tools
---------------

[](https://github.com/manzaltu/claude-code-ide.el#emacs-mcp-tools)
Claude Code IDE includes built-in MCP tools that expose Emacs functionality to Claude, enabling powerful code navigation and analysis capabilities:

### Built-in Tools

[](https://github.com/manzaltu/claude-code-ide.el#built-in-tools)
*   `xref-find-references` - Find all references to a symbol throughout the project
*   `xref-find-apropos` - Find symbols matching a pattern across the entire project
*   `treesit-info` - Get tree-sitter syntax tree information for deep code structure analysis
*   `imenu-list-symbols` - List all symbols (functions, classes, variables) in a file using imenu
*   `project-info` - Get information about the current project (directory, files, etc.)

### Enabling MCP Tools

[](https://github.com/manzaltu/claude-code-ide.el#enabling-mcp-tools)
To enable these tools, add to your configuration:

;; Set up the built-in Emacs tools
(claude-code-ide-emacs-tools-setup)

Once enabled, Claude can use these tools to navigate your codebase. For example:

*   “Find the definition of function foo”
*   “Show me all places where this variable is used”
*   “What type of AST node is under the cursor?”
*   “Analyze the parse tree of this entire file”
*   “List all functions and variables in this file”
*   “How many files are in this project?”

Creating Custom MCP Tools
-------------------------

[](https://github.com/manzaltu/claude-code-ide.el#creating-custom-mcp-tools)
You can expose your own Emacs functions to Claude through the MCP tools system. This allows Claude to interact with specialized Emacs features, custom commands, or domain-specific functionality.

### Tool Definition Format

[](https://github.com/manzaltu/claude-code-ide.el#tool-definition-format)
Each tool definition in `claude-code-ide-mcp-server-tools` follows this format:

'(function-name
  :description "Human-readable description for Claude"
  :parameters ((:name "param1"
                :type "string"
                :required t
                :description "What this parameter does")
               (:name "param2"
                :type "number"
                :required nil
                :description "Optional parameter")))

### Context-Aware Tool Example

[](https://github.com/manzaltu/claude-code-ide.el#context-aware-tool-example)

(defun my-project-grep (pattern)
  "Search for PATTERN in the current session's project."
  (claude-code-ide-mcp-server-with-session-context nil
    ;; This executes with the session's project directory as default-directory
    (let* ((project-dir default-directory)
           (results (shell-command-to-string
                    (format "rg -n '%s' %s" pattern project-dir))))
      results)))

(add-to-list 'claude-code-ide-mcp-server-tools
             '(my-project-grep
               :description "Search for pattern in project files"
               :parameters ((:name "pattern"
                            :type "string"
                            :required t
                            :description "Pattern to search for"))))

License
-------

[](https://github.com/manzaltu/claude-code-ide.el#license)
This project is licensed under the GNU General Public License v3.0 or later. See the LICENSE file for details.

Related Projects
----------------

[](https://github.com/manzaltu/claude-code-ide.el#related-projects)
*   [Claude Code CLI](https://docs.anthropic.com/en/docs/claude-code)
*   [Claude Code VS Code Extension](https://github.com/anthropics/claude-code)
*   [claudecode.nvim](https://github.com/coder/claudecode.nvim) - Neovim integration